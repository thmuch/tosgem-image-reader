# PaintShop Compressed (PSC)

From 1989 to 1991 I wrote a raster graphics application called "PaintShop" (and later on,
["PaintShop+"](https://www.atariuptodate.de/en/675/paintshop-plus) or "PaintShop plus") for
Atari TOS/GEM computers (in [GFA BASIC](https://en.wikipedia.org/wiki/GFA_BASIC) BTW).
It could handle monochrome (black & white) images only, but it offered "hi resolution" (at that time)
images of 640x400 pixels.

PaintShop was able to import and export "standard" (at that time) image file formats, like \*.PIC, \*.DOO,
\*.NEO, \*.ART and \*.PAC. But most, if not all graphics applications offered their own file format as well.
"My" image file format was **P**aint**S**hop **C**ompressed (PSC). Should you ever want to write your own
PSC importer, here is a condensed translation of the PaintShop+ users manual, appendix section 8.1.1.

Have fun! :-)

Thomas\
@thmuch


## File Format Documentation

Let's start with some data type definitions:

| Suffix | Data Type            |
| ----- | --------------------- |
| xxx.b | unsigned byte (8 bit) |
| xxx.w | signed word (16 bit)  |
| xxx.l | signed long (32 bit)  |

PaintShop Compressed is suited for monochrome images only. Images could be of any size, although PaintShop
only supported images up to 640x400 pixels. Image files use the extension \*.PSC.

PSC files have an (at least) 14 bytes long header as follows:

| Header Field Name & Type | Byte Positions | Contents |
| ------------------------ | -------------- | -------- |
| magic.l  | 0..3   | characters "tm89"; this (and only this) is the identification of PSC files |
| prog.l   | 4..7   | four arbitrary characters identifying the generating application; PaintShop uses "PS" + two version bytes; "sp" (+ two version bytes) was generated by the "snapPSC" application; "MBIT" was generated by the META-BIT application |
| resv.b   | 8      | reserved byte; always 2 |
| hlen.b   | 9      | header length in words-1; currently always 1; see below |
| width.w  | 10..11 | image width - 1 |
| height.w | 12..13 | image height - 1 |


### Header Length

hlen.b takes only subsequent fields into account. Value 1 means that 1+1 header words will follow
(width and height). For compatibility reasons you should evaluate hlen.b and skip header words, if hlen.b
is larger than 1.


### Compressed Image Data

Immediately after the header the compressed image data starts. As PSC is a black & white format, there
are no picture planes nor colour tables.

Compressed data consists of a control byte followed by zero or more data bytes.
Control bytes are as follows:

| Control & Data Bytes | Action |
| ---- | --------------------- |
| #0   | white line; no data byte |
| #200 | black line; no data byte |
| #10, #n | repeat last line n+1 times |
| #12, #n | repeat last line n+256 times |
| #100, #n | one line with #n bytes (i.e. with black & white pixels according to the bits in #n); some fill patterns can be compressed this way;  |
| #102, #m, #n | one line with #m*256 + #n words (i.e. with black & white pixels according to the bits in the word); all GEM fill patterns can be compressed this way; #100 should have precedence |
| #110 + data bytes | read one uncompressed line; the number of bytes per line can be computed by (width.w + 8 ) DIV 8 |
| #255 | end of image file; no data byte |


### Uncompressed Image Data

Control byte **#99** is a special case. If the compressed data is larger than the original image,
PSC will not store the inefficiently compressed data, but the uncompressed data instead.

If a PSC file contains control byte #99, it follows directly after the header, followed by uncompressed
bytes for all rows. In this case, the only other control byte is #255 at the end of the file.

It's easy to recognize these uncompressed images â€“ if they use PaintShop's maximum image size of 640x400
pixels, they have a file size of 32016 bytes (PaintShop's maximum file size for PSC images).


### Example

The following example of compressed image data yields an image with one white line, seven black lines
and 260 dotted lines (regardless of image size!):

`#0 #200 #10 #5 #100 #170 #12 #3 #255`
